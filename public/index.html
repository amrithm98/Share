<html ng-app="mymedia">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style>
.feed {
    margin-left: 100px;
    margin-right: 100px;
    margin-top: 50px;
    min-height: 1000px;
}

.feed h3 {
    padding: 20px;
    border: 1px solid green;
    border-radius: 20px;
}

.page {
    margin-left: 100px;
}

.new {
    padding: 20px;
    border: 1px solid blue;
    ;
    border-radius: 20px;

}
</style>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-route.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular-cookies.js"></script>

<script type="text/javascript">
var app = angular.module('mymedia', ['ngRoute','ngCookies']);
app.config(function($routeProvider, $locationProvider) {
    $routeProvider.when('/', {
            templateUrl: 'main.html',
            controller: 'mainctrl'

        })
        .when('/signup', {
            templateUrl: 'signup.html',
            controller: 'regctrl'
        });

});
app.run(function($rootScope,$cookies){
        if($cookies.get('token') && $cookies.get('currentUser'))
        {
            $rootScope.token=$cookies.get('token');
            $rootScope.currentUser=$cookies.get('currentUser');
        }
});
app.controller('mainctrl', function($rootScope,$scope,$http,$cookies) {
    function refresh() {
        $http.get('/d').then(function(response) {
            $scope.data = response.data;
        });
    }
    refresh();
    $scope.login = function() {
        var user = {
            username: $scope.username,
            password: $scope.password
        };
        $http.put('/users/signin', user).then(function(res) {
            console.log(res.data.token);
            $cookies.put('token',res.data.token);
            $cookies.put('currentUser',$scope.username);
            $rootScope.token=res.data.token;
            $rootScope.currentUser=$scope.username;
        }, function(err) {
            alert('login failed');
        });
    };
    $scope.logout = function() {
            $cookies.remove('token');
            $cookies.remove('currentUser');
            $rootScope.token=null;
            $rootScope.currentUser=null;
    };
    $scope.remove = function(data) {
        $http.put('/new/remove', {
            det: data
        },{headers:{'authorization':$rootScope.token}}).then(function() {
            refresh();
        });
    };
    $scope.submit = function() {
        $http.post('/new', {share: $scope.share},{headers:{'authorization':$rootScope.token}}).then(function() {
            refresh();
            $scope.share = '';
        });
    };

});
app.controller('regctrl', function($scope, $http) {
    $scope.reg = function() {
        var newUser = {
            username: $scope.username,
            password: $scope.password
        };
        $http.post('/users', newUser).then(function() {
            alert('success');
        });
    };
});
</script>

<head>
    <title>Amrith</title>
</head>

<body>
    <h1 class="page"><a href="#/">Share</a></h1>
    <div ng-view></div>
</body>

</html>